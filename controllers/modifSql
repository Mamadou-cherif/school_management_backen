USE `suiviprojetpublic`;
DROP procedure IF EXISTS `menus_getMenuFilsByGroupe`;

USE `suiviprojetpublic`;
DROP procedure IF EXISTS `suiviprojetpublic`.`menus_getMenuFilsByGroupe`;
;

DELIMITER $$
USE `suiviprojetpublic`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `menus_getMenuFilsByGroupe`(`menuPereId` INT, `groupeId` INT)
BEGIN
    SELECT `menus`.`id`,
    `menus`.`reference`,
    `menus`.`libelle`,
    `menus`.`descriptions`,
    `menus`.`url`,
    `menus`.`menuPereId`,
    `menus`.`ordre`,
    `menus`.`typeMenu`,
    `menus`.`image`,
    `menus`.`estActif`,
    `menus`.`creationDate`,
    `menus`.`creationUserId`,
    `menus`.`modifDate`,
    `menus`.`modifUserId`
	FROM `menus`
    WHERE `menus`.`menuPereId` = menuPereId
    AND `menus`.`estActif` = 1
    AND `menus`.`id` NOT IN (
        SELECT distinct(`privileges`.`menuId`)
        FROM `privileges`
        INNER JOIN `menus` ON `privileges`.`menuId` = `menus`.`id`
        WHERE `menus`.`menuPereId` = menuPereId
        AND `privileges`.`groupeId` = groupeId
        AND `privileges`.`modeAccesId` = 
        (
            SELECT `modeaccess`.`id` FROM `modeaccess` WHERE `modeaccess`.`libelle` ='Tout' and `modeaccess`.`estActif`=1
        )
    )
    ORDER BY `menus`.`ordre`;
END$$

DELIMITER ;
;



USE `suiviprojetpublic`;
DROP procedure IF EXISTS `onglets_getOngletByGroupe`;

USE `suiviprojetpublic`;
DROP procedure IF EXISTS `suiviprojetpublic`.`onglets_getOngletByGroupe`;
;

DELIMITER $$
USE `suiviprojetpublic`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `onglets_getOngletByGroupe`(`menuId` INT, `groupeId` INT)
BEGIN
   SELECT 
    `onglets`.`id`,
    `onglets`.`menuId`,
    `onglets`.`reference`,
    `onglets`.`libelle`,
    `onglets`.`descriptions`,
    `onglets`.`type`,
    `onglets`.`ordre`,
    `onglets`.`url`,
    `onglets`.`image`,
    `onglets`.`estActif`,
    `onglets`.`creationDate`,
    `onglets`.`creationUserId`,
    `onglets`.`modifDate`,
    `onglets`.`modifUserId`
    FROM `onglets`
    WHERE `onglets`.`menuId` = menuId
    AND `onglets`.`estActif` = 1
    AND `onglets`.`id` NOT IN (
        SELECT distinct(`privileges`.`ongletId`)
        FROM `privileges`
        INNER JOIN `onglets` ON `privileges`.`ongletId` = `onglets`.`id`
        WHERE `onglets`.`menuId` = menuId
        AND `privileges`.`groupeId` = groupeId
        AND `privileges`.`modeAccesId` = 
        (
            SELECT `modeaccess`.`id` FROM `modeaccess` WHERE `modeaccess`.`libelle` ='Tout' and `modeaccess`.`estActif`=1
        )
    )
    ORDER BY `onglets`.`ordre`;
    
END$$

DELIMITER ;
;

