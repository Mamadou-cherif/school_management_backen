USE `suiviprojetpublic`;
DROP procedure IF EXISTS `projets_selectBy`;

USE `suiviprojetpublic`;
DROP procedure IF EXISTS `suiviprojetpublic`.`projets_selectBy`;
;

DELIMITER $$
USE `suiviprojetpublic`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `projets_selectBy`(`id` INT, `programmeId` INT, `code` VARCHAR(5), `titre` TEXT, `description` TEXT, `prioriteId` INT, `nature` VARCHAR(45), `modalites` TEXT, `duree` INT, `debut` DATE, `fin` DATE, `statutId` INT, `observations` TEXT, `estActif` TINYINT, `creationDate` DATETIME, `creationUserId` INT, `modifDate` DATETIME, `modifUserId` INT, `debutDonnees` INT, `finDonnees` INT)
BEGIN
	DECLARE requeteSql varchar(500);
	SET @requeteSql := 'SELECT
		`projets`.`id`,
		`projets`.`programmeId`,
		`projets`.`code`,
		`projets`.`titre`,
		`projets`.`description`,
		`projets`.`prioriteId`,
        `priorites`.`code` as priorite,
		`projets`.`nature`,
		`projets`.`modalites`,
		`projets`.`duree`,
		`projets`.`debut`,
		`projets`.`fin`,
		`projets`.`statutId`,
        `statutprojets`.`code` as statutProjet,
		`projets`.`observations`,
		`projets`.`estActif`,
		`projets`.`creationDate`,
		`projets`.`creationUserId`,
		`projets`.`modifDate`,
		`projets`.`modifUserId`
		FROM `projets`
        INNER JOIN `priorites` ON `projets`.`prioriteId` =  `priorites`.`id`
        INNER JOIN `statutprojets` ON `projets`.`statutId` =  `statutprojets`.`id`
		WHERE 1';
		IF id IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`id` = ',id);
		END IF;
		IF programmeId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`programmeId` = ',programmeId);
		END IF;
		IF code IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`code` = "',code,'"');
		END IF;
		IF titre IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`titre` = "',titre,'"');
		END IF;
		IF description IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`description` = "',description,'"');
		END IF;
		IF prioriteId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`prioriteId` = ',prioriteId);
		END IF;
		IF nature IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`nature` = "',nature,'"');
		END IF;
		IF modalites IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`modalites` = "',modalites,'"');
		END IF;
		IF duree IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`duree` = ',duree);
		END IF;
		IF debut IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`debut` = "',debut,'"');
		END IF;
		IF fin IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`fin` = "',fin,'"');
		END IF;
		IF statutId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`statutId` = ',statutId);
		END IF;
		IF observations IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`observations` = "',observations,'"');
		END IF;
		IF estActif IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`estActif` = ',estActif);
		END IF;
		IF creationDate IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`creationDate` = "',creationDate,'"');
		END IF;
		IF creationUserId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`creationUserId` = ',creationUserId);
		END IF;
		IF modifDate IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`modifDate` = "',modifDate,'"');
		END IF;
		IF modifUserId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `projets`.`modifUserId` = ',modifUserId);
		END IF;
		IF debutDonnees IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' LIMIT ', debutDonnees, ',', finDonnees);
		END IF;

		PREPARE statement FROM @requeteSql;
		EXECUTE statement;
		DEALLOCATE PREPARE statement;

END$$

DELIMITER ;







USE `suiviprojetpublic`;
DROP procedure IF EXISTS `interventions_selectBy`;


DELIMITER $$
CREATE  PROCEDURE `interventions_selectBy`(`id` INT, `prestataireId` INT, `projetId` INT, `categorie` VARCHAR(20), `observations` TEXT, `estActif` TINYINT, `creationDate` DATETIME, `creationUserId` INT, `modifDate` DATETIME, `modifUserId` INT, `debutDonnees` INT, `finDonnees` INT)
BEGIN
	DECLARE requeteSql varchar(500);
	SET @requeteSql := 'SELECT
		`interventions`.`id`,
		`interventions`.`prestataireId`,
        `prestataires`.`nom` as prestataire,
        `prestataires`.`type`,
        `prestataires`.`categorie`,
        `prestataires`.`telephone`,
        `projets`.`titre` as projet,
        `statutprojets`.`code` as statutProjet,
		`interventions`.`projetId`,
	   `priorites`.`code` as priorite,
		`interventions`.`categorie`,
		`interventions`.`observations`
		FROM `interventions`
        INNER JOIN `prestataires` ON `interventions`.`prestataireId`=`prestataires`.`id`
        INNER JOIN `projets` ON `interventions`.`projetId`=`projets`.`id`
         INNER JOIN `priorites` ON `projets`.`prioriteId` =  `priorites`.`id`
        INNER JOIN `statutprojets` ON `projets`.`statutId` =  `statutprojets`.`id`
		WHERE 1';
		IF id IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`id` = ',id);
		END IF;
		IF prestataireId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`prestataireId` = ',prestataireId);
		END IF;
		IF projetId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`projetId` = ',projetId);
		END IF;
		IF categorie IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`categorie` = "',categorie,'"');
		END IF;
		IF observations IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`observations` = "',observations,'"');
		END IF;
		IF estActif IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`estActif` = ',estActif);
		END IF;
		IF creationDate IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`creationDate` = "',creationDate,'"');
		END IF;
		IF creationUserId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`creationUserId` = ',creationUserId);
		END IF;
		IF modifDate IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`modifDate` = "',modifDate,'"');
		END IF;
		IF modifUserId IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' AND `interventions`.`modifUserId` = ',modifUserId);
		END IF;
		IF debutDonnees IS NOT NULL THEN
			SET @requeteSql := CONCAT(@requeteSql, ' LIMIT ', debutDonnees, ',', finDonnees);
		END IF;

		PREPARE statement FROM @requeteSql;
		EXECUTE statement;
		DEALLOCATE PREPARE statement;

END$$

DELIMITER ;


